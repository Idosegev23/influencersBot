/**
 * Fashion Archetype - ×¤××©× ×™×¡×˜×”
 * ××¨×›×™×˜×™×¤ 2: ×¡×˜×™×™×œ×™× ×’, ××™×“×•×ª, ××•×¤× ×”
 */

import { BaseArchetype } from './baseArchetype';
import { ArchetypeDefinition, ArchetypeInput, GuardrailRule } from './types';

// ============================================
// Guardrails for Fashion
// ============================================

const FASHION_GUARDRAILS: GuardrailRule[] = [
  {
    id: 'no-body-shaming',
    description: '××™×¡×•×¨ ××•×—×œ×˜ ×¢×œ Body Shaming',
    triggers: {
      keywords: ['×œ×”×™×¨××•×ª ×¨×–×”', '×œ×”×™×•×ª ×¨×–×”', '×œ×”×¨×–×•×ª', '×œ×©×“×¨ ×¨×–×”', '×œ×”×¡×ª×™×¨ ×©×•××Ÿ'],
      patterns: [/××™×š (×œ×”×™×¨××•×ª|×œ×”×™×•×ª) (×™×•×ª×¨ )?×¨×–(×”|×•×ª)/i],
    },
    action: 'block',
    blockedResponse: '×¡×˜×™×™×œ ×–×” ×œ× ×¢× ×™×™×Ÿ ×©×œ ××™×“×”, ×–×” ×¢× ×™×™×Ÿ ×©×œ ×‘×™×˜×—×•×Ÿ ×¢×¦××™! ğŸ’•\n\n[×©× ×”××©×¤×™×¢× ×™×ª] ××××™× ×” ×©×›×œ ×’×•×£ ×™×¤×”, ×•×©×¡×˜×™×™×œ ×˜×•×‘ ×–×” ×¡×˜×™×™×œ ×©×’×•×¨× ×œ×š ×œ×”×¨×’×™×© ×˜×•×‘ ×¢× ×¢×¦××š.\n\n×‘×•××™ × ×ª××§×“ ×‘×’×–×¨×•×ª ×©××—××™××•×ª ×œ××‘× ×” ×”×’×•×£ ×©×œ×š ×•×‘×¦×‘×¢×™× ×©××ª ××•×”×‘×ª!',
    severity: 'critical',
  },
  {
    id: 'no-counterfeits',
    description: '××™×¡×•×¨ ×”××œ×¦×” ×¢×œ ×–×™×•×¤×™×',
    triggers: {
      keywords: ['×–×™×•×£', '×”×¢×ª×§', '×—×™×§×•×™', '×¤×™×™×§', '×œ× ××§×•×¨×™'],
    },
    action: 'block',
    blockedResponse: '×× ×—× ×• ×œ× ×ª×•××›×•×ª ×‘×–×™×•×¤×™× âŒ\n\n×™×© ×”×¨×‘×” ××•×ª×’×™× × ×’×™×©×™× ×•××“×”×™××™× ×©× ×•×ª× ×™× ××ª ××•×ª×• ×”-Vibe. [×©× ×”××©×¤×™×¢× ×™×ª] ×ª××™×“ ××—×¤×©×ª ××•×¤×¦×™×•×ª ×‘××—×™×¨ ×˜×•×‘ ××‘×œ ×—×•×§×™×•×ª.\n\n××ª ××¢×•× ×™×™× ×ª ×©×××¦× ×œ×š ××œ×˜×¨× ×˜×™×‘×” ×“×•××” ×‘××—×™×¨ × ×’×™×©?',
    severity: 'critical',
  },
  {
    id: 'sizing-disclaimer',
    description: '×ª×–×›×•×¨×ª ×©××™×“×•×ª ××©×ª× ×•×ª ×‘×™×Ÿ ××•×ª×’×™×',
    triggers: {
      keywords: ['××™×“×”', 'size', '×’×–×¨×”', '×¤×™×˜×™× ×’'],
    },
    action: 'warn',
    warningMessage: '×©×™××™ ×œ×‘ ×©××™×“×•×ª ××©×ª× ×•×ª ×‘×™×Ÿ ××•×ª×’×™×! ×›×“××™ ×ª××™×“ ×œ×‘×“×•×§ ××ª ×˜×‘×œ×ª ×”××™×“×•×ª ×©×œ ×”××•×ª×’ ×”×¡×¤×¦×™×¤×™.',
    severity: 'medium',
  },
];

// ============================================
// Fashion Archetype Definition
// ============================================

const FASHION_DEFINITION: ArchetypeDefinition = {
  type: 'fashion',
  name: '×¤××©× ×™×¡×˜×”',
  description: '×¢×•×–×¨×ª ×¢× ×¡×˜×™×™×œ×™× ×’, ×‘×—×™×¨×ª ×‘×’×“×™×, ×©×™×œ×•×‘×™×, ×•××™×“×•×ª',
  
  triggers: {
    keywords: [
      '×‘×’×“', '×××•×˜×¤×™×˜', '×©××œ×”', '×—×•×œ×¦×”', '××›× ×¡×™×™×', '× ×¢×œ×™×™×',
      '×¡×˜×™×™×œ', '××™×“×”', '×¦×‘×¢', '××™×š ××©×œ×‘×™×', '××™×¤×” ×§× ×™×ª',
    ],
  },
  
  logic: {
    buildKnowledgeQuery: (userMessage: string) => {
      return `fashion outfit styling products ${userMessage}`;
    },
    
    responseTemplates: [
      {
        situation: '×—×™×¤×•×© ××•×¦×¨',
        template: '××ª ××—×¤×©×ª ××ª {item} ×©×”×™× ×œ×•×‘×©×ª? ×× ×™ ××©×œ×— ×œ×š ××ª ×”×œ×™× ×§! {coupon}',
        requiredFields: ['item'],
      },
      {
        situation: '×©××œ×ª ×¡×˜×™×™×œ×™× ×’',
        template: '{name} ××©×œ×‘×ª ××ª ×–×” ×¢× {combination}. ×–×” × ×¨××” ××”××! ğŸ”¥',
        requiredFields: ['combination'],
      },
    ],
    
    defaultResponse: '×× ×™ ×›××Ÿ ×œ×¢×–×•×¨ ×¢× ×”×¡×˜×™×™×œ! ×¡×¤×¨×™ ×œ×™ ××” ××ª ××—×¤×©×ª.',
  },
  
  guardrails: FASHION_GUARDRAILS,
  
  examples: [
    {
      userQuestion: '××™×š ×œ×”×™×¨××•×ª ×¨×–×” ×™×•×ª×¨ ×‘×‘×’×“×™×?',
      expectedBehavior: '×—×¡×™××” + ×”×¤× ×™×” ×œ×‘×™×˜×—×•×Ÿ ×¢×¦××™ + ×”××œ×¦×•×ª ×’×–×¨×•×ª ××—××™××•×ª',
    },
  ],
};

// ============================================
// Fashion Archetype Implementation
// ============================================

export class FashionArchetype extends BaseArchetype {
  constructor() {
    super(FASHION_DEFINITION);
  }

  // âš¡ Now uses AI from BaseArchetype with proper Gemini integration!
  // The AI will automatically provide archetype-specific responses based on knowledge base

  private buildProductLocationResponse(kb: any): string {
    return `×× ×™ ××©×œ×— ×œ×š ××ª ×”×œ×™× ×§ ×”××“×•×™×§! 

[×©× ×”××©×¤×™×¢× ×™×ª] ×§× ×ª×” ××ª ×–×” ×-[××•×ª×’] ×•×™×© ×§×•×“ ×”× ×—×” ××™×•×—×“: [×§×•×¤×•×Ÿ]

×¨×’×¢, ×× ×™ ××•×•×“××ª ×©×”×§×•×“ ×¤×¢×™×œ... âœ¨`;
  }

  private buildSizingResponse(kb: any): string {
    return `×œ×’×‘×™ ××™×“×•×ª - [×©× ×”××©×¤×™×¢× ×™×ª] ×œ×•×§×—×ª [××™×“×”] ×‘××•×ª×’ ×”×–×”.

××‘×œ ×©×™××™ ×œ×‘! ğŸ‘—
×›×œ ××•×ª×’ ×¢× ×”×’×–×¨×•×ª ×©×œ×•. ×›×“××™ ×œ×‘×“×•×§:
- ××ª ×˜×‘×œ×ª ×”××™×“×•×ª ×©×œ×”×
- ××ª ×”×‘×™×§×•×¨×•×ª (×× ×›×•×ª×‘×™× ×©×–×” ×’×“×•×œ/×§×˜×Ÿ)
- ×× ××¤×©×¨ ×”×—×–×¨×” ×—×™× ×

×¨×•×¦×” ×©××©×œ×— ×œ×š ××ª ×”×œ×™× ×§ ×¢× ×›×œ ×”××™×“×¢?`;
  }

  private buildStylingResponse(kb: any): string {
    return `××•×”×‘×ª ××ª ×”×©××œ×”! ğŸ”¥

[×©× ×”××©×¤×™×¢× ×™×ª] ××©×œ×‘×ª ××ª ×–×” ×›×›×”:
âœ¨ ×¢× ×’'×™× ×¡ ×§×œ××¡×™ ×œ×¤×©×˜×•×ª
âœ¨ × ×¢×œ×™×™× ×©×˜×•×—×•×ª ×œ××¨××” casual
âœ¨ ×ª×™×§ ×§×˜×Ÿ ×œ××™×–×•×Ÿ

×–×” ×”×¡×•×“ ×©×œ×” - ×¤×©×˜×•×ª ×©× ×¨××™×ª expensive!

×¨×•×¦×” ×¢×•×“ ×¨×¢×™×•× ×•×ª ×œ×©×™×œ×•×‘×™×?`;
  }

  private buildGeneralFashionResponse(kb: any): string {
    return `×× ×™ ×›××Ÿ ×œ×¢×–×•×¨ ×¢× ×”×¡×˜×™×™×œ! ğŸ‘—

[×©× ×”××©×¤×™×¢× ×™×ª] ××××™× ×” ×©××•×¤× ×” ×–×” ×œ×”×¨×’×™×© ×˜×•×‘ ×¢× ××” ×©××ª ×œ×•×‘×©×ª.

×¡×¤×¨×™ ×œ×™:
- ××ª ××—×¤×©×ª ××©×”×• ×¡×¤×¦×™×¤×™?
- ×™×© ××™×¨×•×¢ ××¡×•×™×?
- ×¨×•×¦×” ×¨×¢×™×•× ×•×ª ×œ×©×™×œ×•×‘×™×?

×‘×•××™ × ××¦× ××ª ×”×œ×•×§ ×”××•×©×œ×! âœ¨`;
  }
}

// ============================================
// Export
// ============================================

export function createFashionArchetype(): FashionArchetype {
  return new FashionArchetype();
}
